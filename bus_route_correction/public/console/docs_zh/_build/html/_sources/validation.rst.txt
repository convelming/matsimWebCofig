.. PopulationSim documentation master file
   You can adapt this file completely to your liking, but it should at least
   contain the root `toctree` directive.

.. |br| raw:: html

   <br />

Validation of Results 结果验证
=====================

One of the most critical steps in the population synthesis procedure is the validation of the synthetic
population. Validation can give us clues about inconsistencies among controls, data processing errors or
misspecification of settings. This section provides general guidelines on validation procedures.
在人口合成流程中，最关键的一步是验证合成人口的结果。通过验证，可以揭示控制数据间的不一致性、数据处理错误或设置参数的错误。本节提供关于验证程序的通用指导原则。

PopulationSim reports the difference between the synthesized totals and the control totals for all the controls
at each geographic level. User can select these summaries using the ``output_tables:`` token as described in
the :ref:`settings` section. The :ref:`inputs_outputs` section lists all the summaries available to user.
Most population synthesizers will match each control very well at a regional level; therefore such summaries
are useful but not very insightful into the goodness-of-fit of the tool at lower level geographies. Users
can download a `validation Jupyter Notebook <https://github.com/activitysim/populationSim/tree/master/scripts>`_ to
generate advanced summary statistics and validation plots. This validation notebook takes summaries and
outputs from a PopulationSim run and generates plots and advanced summaries. The notebook is configured to run
for the CALM region example and includes notes on inputs and configuration settings. To download and run
the CALM region example refer to the :ref:`getting_started` section.
PopulationSim 会报告各个地理层级上所有控制项的合成总量与控制总量之间的差异。用户可以使用 output_tables: 标记来选择这些汇总报告，具体方法已在 :ref:`settings` 部分说明。:ref:`inputs_outputs` 部分列出了所有可供用户使用的汇总报告。
大多数人口合成工具在区域层面都能很好地匹配每个控制项；因此，此类汇总报告虽然有用，但对于了解工具在更细地理层级上的拟合优度，其深入洞察力有限。
用户可以下载 验证用的 `Jupyter Notebook <https://github.com/activitysim/populationSim/tree/master/scripts>`_ 来生成高级的汇总统计数据和验证图表。这个验证笔记本会读取 PopulationSim 运行的汇总报告和输出结果，并生成图表和高级汇总。该笔记本已配置为针对 CALM 区域示例运行，并包含了输入和配置设置的说明。要下载并运行 CALM 区域示例，请参阅 :ref:`getting_started` 部分。


Validation Summary Statistics 验证的数理统计摘要
-----------------------------

Statistics related to the convergence at a more disaggregate level are generated by the validation notebook.  These statistics are being computed for the geography at which the controls are specified i.e. MAZ, TAZ or Meta as the case might be. The following three statistics are computed: |br|
验证笔记本会生成与更细粒度（指定控制项的地理层级，可能是MAZ、TAZ或Meta等）收敛情况相关的统计数据。计算以下三项统计指标： |br|
1. The average percentage difference between the control totals and the synthesized totals, |br|
平均百分比差异：控制总量与合成总量之间的平均百分比差异。 |br|
2. The standard deviation (STDEV) of the percentage difference – this measure describes how much dispersion from the average exists, and  百分比差异的标准差：描述数据相对于平均值的离散程度，以及|br|

3. The percentage root mean square error (RMSE) - an indicator of the proximity of synthesized and control totals. 百分比均方根误差：评估合成总量与控制总量接近程度的指标。|br|

The number of geographies for which the control is non-zero (N) are also reported.
同时，还会报告控制项为非零值的地理单元数量。


Charts & Plots 图表
--------------

The validation notebook also produces charts and plots which includes frequency distribution and expansion factor distribution plots.
验证笔记本还会生成图表，包括频率分布图和扩展因子分布图。


Validation Charts验证图表
~~~~~~~~~~~~~~~~~

The validation chart is a visualization of the disaggregate summary statistics – mean percentage difference, STDEV and RMSE of percentage differences. A form of dot and whisker plot is generated for each control where the dots are the mean percentage differences and horizontal bars are twice the STDEV or RMSE centered around zero. An example validation chart is below:
验证图表是对细粒度汇总统计（即百分比差异的平均值、标准差和均方根误差）的可视化展示。它会为每个控制项生成一种形式的“点线图”（或称“误差棒图”），其中圆点代表平均百分比差异，水平条则代表以零为中心、两倍标准差或两倍均方根误差的范围。下图是一个验证图表的示例：

  .. image:: images/validation.jpeg

Frequency Distribution Plots 频率分布图
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

These are frequency distribution plots of differences between control and synthesized values across the geography at which the controls were specified. An example frequency distribution plot is below:
这些图表展示了在指定控制项的地理层级上，控制值与合成值之间差异的频率分布。下图是一个频率分布图的示例：

  .. image:: images/hh_inc_30_60_control.png

Expansion Factor Distributions扩展因子分布
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

While a synthetic population may match the controls well, it is important to know how uniform the household weights are, and how different they are from the initial weights. The closer the final weights are to the initial PUMS weight, the higher the probability of matching the distribution of uncontrolled variables. An expansion factor is computed for each record in the seed data as total final weight/initial weight. A distribution plot of these expansion factors is created for each Seed geography. A good synthetic population would have most of these expansion factors as close to one as possible. An example expansion factor distribution is shown below:
尽管合成人口可能与控制数据匹配良好，但了解家庭权重的均匀程度以及它们与初始权重的差异大小至关重要。最终权重越接近初始PUMS权重，匹配非控制变量分布的概率就越高。扩展因子的计算方法为：总最终权重 / 初始权重，针对种子数据中的每条记录进行计算。会为每个种子地理层级创建这些扩展因子的分布图。一个理想的合成人口应使大多数扩展因子尽可能接近1。下图展示了一个扩展因子分布示例
  .. image:: images/EF-Distribution.png
